@using UPProjects.Models
@model UPProjects.Models.MPRMaster
@{
    ViewData["Title"] = "MPRMaster";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var count = 1;
}
<label id="dept" style="display:none;">@Model.DepartmentId</label>
<label id="y" style="display:none;">@Model.StartYear</label>
<label id="m" style="display:none;">@Model.StartMonth</label>
<div class="row page-title-header">
    <div class="col-12">
        <div class="page-header">
            <h4 class="page-title text-center">
                 MPR
            </h4>
        </div>
    </div>
</div>
<div class="col-md-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-sm-10">
                    यूनिट-<label style="margin-left:7px;font-size:20px;">@ViewBag.user</label>
                </div>
                <div class="col-sm-2">
                    इकाई- (रुपये लाख में)
                </div>
            </div>

            <br />
            <form>
                @Html.HiddenFor(x => x.Id)
                <div class="row">
                    <div class="col-sm-4">

                        <label> वर्ष</label>
                        <span class="text-danger">*</span>
                        <select asp-for="StartYear" class="form-control" id="StartYear" onchange="BindMonth()">
                        </select>
                    </div>
                    <div class="col-sm-4">

                        <label> माह</label>
                        <span class="text-danger">*</span>
                        <select asp-for="StartMonth" class="form-control" id="StartMonth">
                        </select>
                    </div>
                    <div class="col-sm-4">

                        <label>विभाग का नाम</label>
                        <span class="text-danger">*</span>
                        <select asp-for="DepartmentId" class="form-control" id="DepartmentId">
                        </select>

                    </div>


                </div>
                <br />
                <div class="row">
                    <div class="col-sm-4">

                        <label>कार्य का नाम</label>
                        <span class="text-danger">*</span>
                        <input type="text" asp-for="WorkName" autocomplete="off" class="form-control" id="WorkName" placeholder="कार्य का नाम" maxlength="100">
                    </div>
                    <div class="col-sm-4">

                        <label>शासनादेश संख्या एवं स्वीकृत धनराशि</label>
                        <span class="text-danger">*</span>
                        <input type="text" asp-for="AcceptableMoney" autocomplete="off" class="form-control" id="AcceptableMoney" maxlength="100">
                    </div>
                    <div class="col-sm-4">
                        <label>अवमुक्त धनराशि</label>
                        <span class="text-danger">*</span>
                        <input type="text" asp-for="AvmuktMoney" autocomplete="off" class="form-control" id="AvmuktMoney" onkeypress="return isNumberKey(event)" maxlength="10">
                    </div>


                </div>
                <br />
                <div class="row">
                    <div class="col-sm-4">
                        <label>वित्तीय  प्रगति</label>
                        <span class="text-danger">*</span>
                        <input type="text" asp-for="VithyaPragati" autocomplete="off" class="form-control" id="VithyaPragati" onkeypress="return isNumberKey(event)" maxlength="10">
                    </div>
                    <div class="col-sm-4">
                        <label>भौतिक प्रगति</label>
                        <span class="text-danger">*</span>
                        <input type="text" asp-for="BhotikPragati" autocomplete="off" class="form-control" id="BhotikPragati" onkeypress="return isNumberKey(event)" maxlength="10">
                    </div>
                    <div class="col-sm-4">
                        <label>अभियुक्ति</label>
                        <span class="text-danger">*</span>
                        <input type="text" asp-for="Remark" autocomplete="off" class="form-control" id="Remark" style="height:50px;">
                    </div>


                </div>
                <br />
                <div class="row">
                    <div class="col-sm-2">
                        @if (Model.Id == 0)
                        {
                            <input type="button" id="btnSave" value="Submit" class="btn btn-success" />
                        }
                        else
                        {
                            <input type="button" id="btnSave" value="Update" class="btn btn-success" />
                        }
                    </div>

                </div>



            </form>
            <hr />
            <br />
            <table class="table table-bordered" id="tblData">
                <thead>
                    <tr>
                        <th>क्रम संख्या</th>
                        <th>विभाग का नाम</th>
                        <th>वर्ष</th>
                        <th>माह</th>
                        <th>कार्य का नाम</th>
                        <th>शासनादेश संख्या एवं स्वीकृत धनराशि</th>
                        <th>अवमुक्त धनराशि</th>
                        <th>वित्तीय  प्रगति</th>
                        <th>भौतिक प्रगति</th>
                        <th class="not-export-column">Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in ViewBag.List)
                    {
                    <tr>
                        <td>@count</td>
                        <td>@item.DepartmentName</td>
                        <td>@item.StartYear</td>
                        <td>
                            @if (item.StartMonth == "1")
                            {
                                <label>January</label>
                            }
                            @if (item.StartMonth == "2")
                            {
                                <label>February</label>
                            }@if (item.StartMonth == "3")
                            {
                                <label>March</label>
                            }@if (item.StartMonth == "4")
                            {
                                <label>April</label>
                            }@if (item.StartMonth == "5")
                            {
                                <label>May</label>
                            }
                            @if (item.StartMonth == "6")
                            {
                                <label>June</label>
                            }
                            @if (item.StartMonth == "7")
                            {
                                <label>July</label>
                            }
                            @if (item.StartMonth == "8")
                            {
                                <label>August</label>
                            }
                            @if (item.StartMonth == "9")
                            {
                                <label>September</label>
                            }
                            @if (item.StartMonth == "10")
                            {
                                <label>October</label>
                            }
                            @if (item.StartMonth == "11")
                            {
                                <label>November</label>
                            }
                            @if (item.StartMonth == "12")
                            {
                                <label>December</label>
                            }

                        </td>


                        <td>@item.WorkName</td>
                        <td>@item.AcceptableMoney</td>
                        <td>@item.AvmuktMoney</td>
                        <td>@item.VithyaPragati</td>
                        <td>@item.BhotikPragati</td>
                        <td class="not-export-column">
                            <input type="button" value="Edit" class="btn btn-primary btn-sm" onclick="UpdateMPR(@item.Id)" />
                            <input type="button" value="Delete" class="btn btn-danger btn-sm" onclick="DeleteMPR(@item.Id)" />
                        </td>
                    </tr>
                        count++;
                    }
                </tbody>

            </table>


        </div>

    </div>

</div>

@section Scripts{
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script type="text/javascript">
        $(document).ready(function () {

            $("#tblData").DataTable( {
       // dom: 'Blfrtip',
            dom:'Bfrtip',
          buttons: [
            {
                extend: 'print',
                  title: 'MPR',
                exportOptions: {
                   columns: ":not(.not-export-column)"
                }
            },
            {
                extend: 'excel',
                title: 'MPR',
                exportOptions: {
                   columns: ":not(.not-export-column)"
                }
            }
            ]
    } );
            BindDepartment();
            BindYear();
           // BindMonth();

        })

        function BindYear() {

            var url = "/MPR/BindYear";
            $("#StartYear").empty();
            $('#StartYear').append('<option value="0">वर्ष</option>');
            $.getJSON(url, function (data) {
                for (var i = 0; i < data.length; i++) {
                    $('#StartYear').append('<option value="' + data[i].id + '">' + data[i].value + '</option>');
                }
                var unit = $("#y").html();
                if (unit == "") {

                }
                else {
                    $('#StartYear').val(unit.trim());
                }


            })
        }
        function BindMonth() {

            var year = $('#StartYear').val();
            var url = "/MPR/BindMonth?year=" + year;
            $("#StartMonth").empty();
            $('#StartMonth').append('<option value="0">माह</option>');
            $.getJSON(url, function (data) {
                for (var i = 0; i < data.length; i++) {
                    $('#StartMonth').append('<option value="' + data[i].id + '">' + data[i].value + '</option>');
                }
                var unit = $("#m").html();
                if (unit == "") {

                }
                else {
                    $('#StartMonth').val(unit.trim());
                }

            })
        }
        function BindDepartment() {

            var url = "/Master/BindDepartment";
            $("#DepartmentId").empty();
            $('#DepartmentId').append('<option value="0">विभाग का नाम</option>');
            $.getJSON(url, function (data) {
                debugger;

                for (var i = 0; i < data.length; i++) {
                    $('#DepartmentId').append('<option value="' + data[i].departmentId + '">' + data[i].departmentName + '</option>');
                }
                var dept = $("#dept").html();
                if (dept != "" || dept != null || dept != "0") {
                    $('#DepartmentId').val(dept.trim());
                }
            })
        }

        $("#btnSave").click(function () {

            if ($("#StartYear").val() == "" || $("#StartYear").val() == "0" || $("#StartYear").val() == null) {
                alert("कृपया वर्ष सेलेक्ट  करे");
                return false;
            }
            if ($("#StartMonth").val() == "" || $("#StartMonth").val() == "0" || $("#StartMonth").val() == null) {
                alert("कृपया माह सेलेक्ट  करे");
                return false;
            }
            if ($("#DepartmentId").val() == "" || $("#DepartmentId").val() == "0" || $("#DepartmentId").val() == null) {
                alert("कृपया विभाग का नाम सेलेक्ट  करे");
                return false;
            }
            if ($("#WorkName").val() == "" || $("#WorkName").val() == "0" || $("#WorkName").val() == null) {
                alert("कृपया कार्य का नाम लिखे");
                return false;
            }
            if ($("#AcceptableMoney").val() == "" || $("#AcceptableMoney").val() == "0" || $("#AcceptableMoney").val() == null) {
                alert("कृपया शासनादेश संख्या एवं स्वीकृत धनराशि लिखे");
                return false;
            }
            if ($("#AvmuktMoney").val() == "" || $("#AvmuktMoney").val() == "0" || $("#AvmuktMoney").val() == null) {
                alert("कृपया अवमुक्त धनराशि लिखे");
                return false;
            }
            if ($("#VithyaPragati").val() == "" || $("#VithyaPragati").val() == "0" || $("#VithyaPragati").val() == null) {
                alert("कृपया वित्तीय  प्रगति लिखे");
                return false;
            }
            if ($("#BhotikPragati").val() == "" || $("#BhotikPragati").val() == "0" || $("#BhotikPragati").val() == null) {
                alert("कृपया भौतिक प्रगति लिखे");
                return false;
            }
            if ($("#Remark").val() == "" || $("#Remark").val() == "0" || $("#Remark").val() == null) {
                alert("कृपया अभियुक्ति लिखे");
                return false;
            }



            $.ajax({
                type: "POST",
                url: "/MPR/SaveMPR",
                data: $('form').serialize(),
                success: function (data) {
                    alert(data);
                    window.location.reload();
                }

            });



        });
        function UpdateMPR(Id) {
            location.href = "/MPR/MPRMaster/" + Id;
        }
        function DeleteMPR(Id) {
            if (confirm("Do you want to delete this record?")) {
                $.ajax({
                    type: "POST",
                    url: "/MPR/DeleteMPR",
                    data: { Id: Id },
                    success: function (data) {
                        alert(data);
                        window.location.href = "/MPR/MPRMaster/0";
                    }

                });
            }
        }

        function isNumberKey(evt) {
            var charCode = (evt.which) ? evt.which : event.keyCode;
            if (charCode != 46 && charCode > 31
                && (charCode < 48 || charCode > 57))
                return false;

            return true;
        }

    </script>

}


